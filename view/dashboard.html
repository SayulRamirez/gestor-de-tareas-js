<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor</title>
    <link rel="stylesheet" href="../css/base/base.css">
    <link rel="stylesheet" href="../css/base/menu.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../js/jwt.js"></script>
    <script src="../js/language.js"></script>
    <script src="../js/service/project-service.js"></script>
</head>
<body>
    <header>
        <div class="topnav" id="myTopnav">
            <a href="dashboard.html" class="active">Home</a>
            <a href="#contact">Crear Proyecto</a>
            <a href="#about">Tareas</a>
            <a href="#salir">Salir</a>
            <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                <i class="fa fa-bars"></i>
            </a>
        </div>

        <script>
            function myFunction() {
                var x = document.getElementById("myTopnav");
                if (x.className === "topnav") {
                    x.className += " responsive";
                } else {
                    x.className = "topnav";
                }
            }
        </script>
    </header>
    <main>
        <div class="filter">
            <button class="button-filter selected">Todos</button>
            <button class="button-filter">Pendientes</button>
            <button class="button-filter">En progreso</button>
            <button class="button-filter">Completas</button>
        </div>
        <section id="section-projects" class="projects"></section>
    </main>
    <script>
        const buttons = document.querySelectorAll('.button-filter');

        buttons.forEach(button => {
            button.addEventListener('click', (event) => {

                buttons.forEach(b => {
                    // if (event.target !== b) {
                        b.classList.remove('selected');
                        // }
                    });

                event.target.classList.add('selected');
            });
        });
    </script>
</body>

<script>

    if ( !isTokenValid() ) {
        alert("El token a expirado o es invalidio.\nEs necesario volver a iniciar sesiÃ³n.");
        localStorage.removeItem("token");
        window.location.href = "../index.html";
    }

    getAllProjectsByUser().then( response => {

        response.data.forEach(project => {
            
            let template = templateProject.content.cloneNode(true);

            template.querySelector('.project').setAttribute('data-status', project.status);
            template.querySelector('.project').setAttribute('data-id', project.id);

            let title = template.querySelector('.project-title');
            let status = template.querySelector('.project-status');

            title.innerText = project.title;
            status.innerText = statusToSpanish(project.status);

            document.getElementById('section-projects').appendChild(template);
        });
    });
        
</script>

<template id="templateProject">
    <article class="project" data-status="" data-id="">
        <div class="project-desc">
            <h2 class="project-title"></h2>
            <p class="project-status"></p>
        </div>
        <img src="../img/default-project.jpeg" alt="Trabajando en un proyecto">
    </article>
</template>
</html>